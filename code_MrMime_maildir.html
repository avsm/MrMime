<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="MrMime" rel="Chapter" href="MrMime.html">
<link title="MrMime_parser" rel="Chapter" href="MrMime_parser.html">
<link title="MrMime_input" rel="Chapter" href="MrMime_input.html">
<link title="MrMime_quotedPrintable" rel="Chapter" href="MrMime_quotedPrintable.html">
<link title="MrMime_base64" rel="Chapter" href="MrMime_base64.html">
<link title="MrMime_date" rel="Chapter" href="MrMime_date.html">
<link title="MrMime_msgID" rel="Chapter" href="MrMime_msgID.html">
<link title="MrMime_mimeVersion" rel="Chapter" href="MrMime_mimeVersion.html">
<link title="MrMime_contentEncoding" rel="Chapter" href="MrMime_contentEncoding.html">
<link title="MrMime_contentType" rel="Chapter" href="MrMime_contentType.html">
<link title="MrMime_content" rel="Chapter" href="MrMime_content.html">
<link title="MrMime_address" rel="Chapter" href="MrMime_address.html">
<link title="MrMime_resent" rel="Chapter" href="MrMime_resent.html">
<link title="MrMime_trace" rel="Chapter" href="MrMime_trace.html">
<link title="MrMime_header" rel="Chapter" href="MrMime_header.html">
<link title="MrMime_message" rel="Chapter" href="MrMime_message.html">
<link title="MrMime_maildir" rel="Chapter" href="MrMime_maildir.html"><title>MrMime_maildir</title>
</head>
<body>
<code class="code"><span class="keyword">module</span>&nbsp;<span class="constructor">Map</span>&nbsp;=&nbsp;<span class="constructor">Map</span>.<span class="constructor">Make</span>(<span class="constructor">String</span>)

<span class="keyword">type</span>&nbsp;safe
<span class="keyword">type</span>&nbsp;unsafe

<span class="keyword">type</span>&nbsp;<span class="keywordsign">'</span>a&nbsp;t&nbsp;=
&nbsp;&nbsp;{&nbsp;sequence&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;crypto_random&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;inode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;microsecond&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;pid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option
&nbsp;&nbsp;;&nbsp;deliveries&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int&nbsp;option&nbsp;}

<span class="keyword">let</span>&nbsp;make&nbsp;?sequence
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?boot
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?crypto_random
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?inode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?device
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?microsecond
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?pid
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?deliveries&nbsp;()&nbsp;:&nbsp;unsafe&nbsp;t&nbsp;=
&nbsp;&nbsp;{&nbsp;sequence
&nbsp;&nbsp;;&nbsp;boot
&nbsp;&nbsp;;&nbsp;crypto_random
&nbsp;&nbsp;;&nbsp;inode
&nbsp;&nbsp;;&nbsp;device
&nbsp;&nbsp;;&nbsp;microsecond
&nbsp;&nbsp;;&nbsp;pid
&nbsp;&nbsp;;&nbsp;deliveries&nbsp;}

<span class="keyword">let</span>&nbsp;to_safe&nbsp;(x&nbsp;:&nbsp;unsafe&nbsp;t)&nbsp;:&nbsp;safe&nbsp;t&nbsp;option&nbsp;=
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Option</span>&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;is_some&nbsp;x.sequence
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.boot
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.crypto_random
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.inode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.device
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.microsecond
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.pid
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">||</span>&nbsp;is_some&nbsp;x.deliveries
&nbsp;&nbsp;<span class="keyword">then</span>&nbsp;<span class="constructor">Some</span>&nbsp;{&nbsp;sequence&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x.sequence
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x.boot
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;crypto_random&nbsp;=&nbsp;x.crypto_random
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;inode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x.inode
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x.device
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;microsecond&nbsp;&nbsp;&nbsp;=&nbsp;x.microsecond
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;pid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x.pid
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;deliveries&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x.deliveries&nbsp;}
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">None</span>

<span class="keyword">type</span>&nbsp;id&nbsp;=
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Modern</span>&nbsp;<span class="keyword">of</span>&nbsp;safe&nbsp;t
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Old0</span>&nbsp;<span class="keyword">of</span>&nbsp;int
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Old1</span>&nbsp;<span class="keyword">of</span>&nbsp;int&nbsp;*&nbsp;int

<span class="keyword">type</span>&nbsp;flag&nbsp;=
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Passed</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Replied</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Seen</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Trashed</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Draft</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Flagged</span>

<span class="keyword">type</span>&nbsp;<span class="keywordsign">'</span>a&nbsp;info&nbsp;=
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Exp</span>&nbsp;<span class="keyword">of</span>&nbsp;<span class="keywordsign">'</span>a
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Info</span>&nbsp;<span class="keyword">of</span>&nbsp;flag&nbsp;list

<span class="keyword">type</span>&nbsp;<span class="keywordsign">'</span>a&nbsp;filename&nbsp;=
&nbsp;&nbsp;{&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;int
&nbsp;&nbsp;;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;id
&nbsp;&nbsp;;&nbsp;host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;string
&nbsp;&nbsp;;&nbsp;parameters&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;string&nbsp;<span class="constructor">Map</span>.t
&nbsp;&nbsp;;&nbsp;info&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<span class="keywordsign">'</span>a&nbsp;info&nbsp;}

<span class="keyword">let</span>&nbsp;pp&nbsp;=&nbsp;<span class="constructor">Format</span>.fprintf

<span class="keyword">let</span>&nbsp;pp_lst&nbsp;~sep&nbsp;pp_data&nbsp;fmt&nbsp;lst&nbsp;=
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;aux&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;()
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[&nbsp;x&nbsp;]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp_data&nbsp;fmt&nbsp;x
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"%a%a"</span>&nbsp;pp_data&nbsp;x&nbsp;sep&nbsp;();&nbsp;aux&nbsp;r
&nbsp;&nbsp;<span class="keyword">in</span>&nbsp;aux&nbsp;lst

<span class="keyword">let</span>&nbsp;pp_flag&nbsp;fmt&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Passed</span>&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Passed"</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Replied</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Replied"</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Seen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Seen"</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Trashed</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Trashed"</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Draft</span>&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Draft"</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Flagged</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Flagged"</span>

<span class="keyword">let</span>&nbsp;pp_info&nbsp;pp_experimental&nbsp;fmt&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Exp</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp_experimental&nbsp;fmt&nbsp;a
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Info</span>&nbsp;l&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"[@[&lt;hov&gt;%a@]]"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pp_lst&nbsp;~sep:(<span class="keyword">fun</span>&nbsp;fmt&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">";@&nbsp;"</span>)&nbsp;pp_flag)&nbsp;l

<span class="keyword">let</span>&nbsp;pp_option&nbsp;pp_data&nbsp;fmt&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;a&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp_data&nbsp;fmt&nbsp;a
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"&lt;none&gt;"</span>

<span class="keyword">let</span>&nbsp;pp_t&nbsp;fmt&nbsp;{&nbsp;sequence;&nbsp;boot;&nbsp;crypto_random;&nbsp;inode;&nbsp;device;&nbsp;microsecond;&nbsp;pid;&nbsp;deliveries;&nbsp;}&nbsp;=
&nbsp;&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"{@[&lt;hov&gt;sequence&nbsp;=&nbsp;%a;@&nbsp;boot&nbsp;=&nbsp;%a;@&nbsp;crypto_random&nbsp;=&nbsp;%a;@&nbsp;inode&nbsp;=&nbsp;%a;@&nbsp;device&nbsp;=&nbsp;%a;@&nbsp;microsecond&nbsp;=&nbsp;%a;@&nbsp;pid&nbsp;=&nbsp;%a;@&nbsp;deliveries&nbsp;=&nbsp;%a@]}"</span>
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;sequence
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;boot
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;crypto_random
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;inode
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;device
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;microsecond
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;pid
&nbsp;&nbsp;&nbsp;&nbsp;(pp_option&nbsp;<span class="constructor">Format</span>.pp_print_int)&nbsp;deliveries

<span class="keyword">let</span>&nbsp;pp_id&nbsp;fmt&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Modern</span>&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Modern&nbsp;%a"</span>&nbsp;pp_t&nbsp;t
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Old0</span>&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Old&nbsp;%d"</span>&nbsp;i
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Old1</span>&nbsp;(a,&nbsp;b)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"Old&nbsp;(%d,&nbsp;%d)"</span>&nbsp;a&nbsp;b

<span class="keyword">let</span>&nbsp;pp_map&nbsp;fmt&nbsp;map&nbsp;=
&nbsp;&nbsp;<span class="constructor">Map</span>.iter
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">fun</span>&nbsp;key&nbsp;value&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"%s&nbsp;-&gt;&nbsp;%s@\n"</span>&nbsp;key&nbsp;value)
&nbsp;&nbsp;&nbsp;&nbsp;map

<span class="keyword">let</span>&nbsp;pp_filename&nbsp;pp_experimental&nbsp;fmt&nbsp;{&nbsp;time;&nbsp;id;&nbsp;host;&nbsp;parameters;&nbsp;info;&nbsp;}&nbsp;=
&nbsp;&nbsp;pp&nbsp;fmt&nbsp;<span class="string">"{@[&lt;hov&gt;time&nbsp;=&nbsp;%d;@&nbsp;id&nbsp;=&nbsp;@[&lt;hov&gt;%a@];@&nbsp;host&nbsp;=&nbsp;%S;@&nbsp;parameters&nbsp;=&nbsp;@[&lt;hov&gt;%a@];@&nbsp;info&nbsp;=&nbsp;@[&lt;hov]%a@]@]}"</span>
&nbsp;&nbsp;&nbsp;&nbsp;time
&nbsp;&nbsp;&nbsp;&nbsp;pp_id&nbsp;id
&nbsp;&nbsp;&nbsp;&nbsp;host
&nbsp;&nbsp;&nbsp;&nbsp;pp_map&nbsp;parameters
&nbsp;&nbsp;&nbsp;&nbsp;(pp_info&nbsp;pp_experimental)&nbsp;info

<span class="keyword">open</span>&nbsp;<span class="constructor">Parser</span>
<span class="keyword">open</span>&nbsp;<span class="constructor">Parser</span>.<span class="constructor">Convenience</span>

<span class="keyword">type</span>&nbsp;err&nbsp;+=&nbsp;<span class="constructor">Invalid_filename</span>

<span class="keyword">let</span>&nbsp;implode&nbsp;l&nbsp;=
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;s&nbsp;=&nbsp;<span class="constructor">Bytes</span>.create&nbsp;(<span class="constructor">List</span>.length&nbsp;l)&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;aux&nbsp;i&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Bytes</span>.unsafe_to_string&nbsp;s
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Bytes</span>.set&nbsp;s&nbsp;i&nbsp;x;&nbsp;aux&nbsp;(i&nbsp;+&nbsp;1)&nbsp;r
&nbsp;&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;aux&nbsp;0&nbsp;l

<span class="keyword">let</span>&nbsp;avoid&nbsp;=&nbsp;return&nbsp;()

<span class="keyword">let</span>&nbsp;parse&nbsp;experimental&nbsp;=
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;is_digit&nbsp;=&nbsp;<span class="keyword">function</span>&nbsp;<span class="string">'0'</span>&nbsp;..&nbsp;<span class="string">'9'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">true</span>&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;digit&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;repeat&nbsp;(<span class="constructor">Some</span>&nbsp;1)&nbsp;<span class="constructor">None</span>&nbsp;is_digit&nbsp;&gt;&gt;|&nbsp;int_of_string&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sequence&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'#'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'X'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;crypto_random&nbsp;=&nbsp;char&nbsp;<span class="string">'R'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;inode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'I'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'V'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;microsecond&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'M'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'P'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;deliveries&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;char&nbsp;<span class="string">'Q'</span>&nbsp;*&gt;&nbsp;digit&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;modern&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(sequence&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Sequence</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(boot&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Boot</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(crypto_random&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">CryptoRandom</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(inode&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Inode</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(device&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Device</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(microsecond&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Microsecond</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(pid&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Pid</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(deliveries&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Deliveries</span>&nbsp;x)
&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;modern&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;one&nbsp;modern
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;l&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;f&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;i&nbsp;s&nbsp;fail&nbsp;succ&nbsp;<span class="keywordsign">-&gt;</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;catch&nbsp;acc&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Sequence</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;sequence&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Boot</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;boot&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">CryptoRandom</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;crypto_random&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Inode</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;inode&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Device</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;device&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Microsecond</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;microsecond&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Pid</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;pid&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Deliveries</span>&nbsp;x&nbsp;::&nbsp;r&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;catch&nbsp;{&nbsp;acc&nbsp;<span class="keyword">with</span>&nbsp;deliveries&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;}&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;acc&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;succ&nbsp;i&nbsp;s&nbsp;(catch&nbsp;(make&nbsp;())&nbsp;l)&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;|&nbsp;to_safe
&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;host&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;one
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;(string&nbsp;(<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x)&nbsp;<span class="string">"\057"</span>&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return&nbsp;<span class="string">'/'</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(string&nbsp;(<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x)&nbsp;<span class="string">"\072"</span>&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return&nbsp;<span class="string">':'</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(satisfy&nbsp;(<span class="keyword">function</span>&nbsp;<span class="string">','</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">true</span>)))
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;|&nbsp;implode
&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;parameters&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;one&nbsp;(&nbsp;&nbsp;&nbsp;repeat&nbsp;<span class="constructor">None</span>&nbsp;<span class="constructor">None</span>&nbsp;(<span class="keyword">function</span>&nbsp;<span class="string">'='</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">':'</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">','</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">true</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;k&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;char&nbsp;<span class="string">'='</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&gt;&nbsp;repeat&nbsp;<span class="constructor">None</span>&nbsp;<span class="constructor">None</span>&nbsp;(<span class="keyword">function</span>&nbsp;<span class="string">'='</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">':'</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="string">','</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">true</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return&nbsp;(k,&nbsp;v))
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;lst&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">List</span>.fold_right&nbsp;(<span class="keyword">fun</span>&nbsp;(key,&nbsp;value)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Map</span>.add&nbsp;key&nbsp;value)&nbsp;lst&nbsp;<span class="constructor">Map</span>.empty
&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;digit
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;(modern&nbsp;&gt;&gt;=&nbsp;<span class="keyword">function</span>&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return&nbsp;(<span class="constructor">Modern</span>&nbsp;x)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;fail&nbsp;<span class="constructor">Invalid_filename</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(digit&nbsp;&lt;*&nbsp;char&nbsp;<span class="string">'_'</span>&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;digit&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Old1</span>&nbsp;(n,&nbsp;m))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(digit&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Old0</span>&nbsp;x))
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;host
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;host&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;option&nbsp;<span class="constructor">Map</span>.empty&nbsp;(char&nbsp;<span class="string">','</span>&nbsp;*&gt;&nbsp;parameters)
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;parameters&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;char&nbsp;<span class="string">':'</span>&nbsp;*&gt;&nbsp;peek_chr&nbsp;&gt;&gt;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;<span class="string">'1'</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;char&nbsp;<span class="string">','</span>&nbsp;*&gt;&nbsp;experimental&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;e&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;time;&nbsp;id;&nbsp;host;&nbsp;parameters;&nbsp;info&nbsp;=&nbsp;<span class="constructor">Exp</span>&nbsp;e&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;<span class="string">'2'</span>&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;flag&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(char&nbsp;<span class="string">'P'</span>&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Passed</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(char&nbsp;<span class="string">'R'</span>&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Replied</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(char&nbsp;<span class="string">'S'</span>&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Seen</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(char&nbsp;<span class="string">'T'</span>&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Trashed</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(char&nbsp;<span class="string">'D'</span>&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Draft</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;(char&nbsp;<span class="string">'F'</span>&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Flagged</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;flags&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fix&nbsp;@@&nbsp;<span class="keyword">fun</span>&nbsp;m&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(lift2&nbsp;(<span class="keyword">function</span>&nbsp;<span class="constructor">Some</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">fun</span>&nbsp;r&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x&nbsp;::&nbsp;r
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">fun</span>&nbsp;r&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;r)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(option&nbsp;<span class="constructor">None</span>&nbsp;(flag&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Some</span>&nbsp;x))&nbsp;m)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;|&gt;&nbsp;return&nbsp;[]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;<span class="string">','</span>&nbsp;*&gt;&nbsp;flags&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;l&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;time;&nbsp;id;&nbsp;host;&nbsp;parameters;&nbsp;info&nbsp;=&nbsp;<span class="constructor">Info</span>&nbsp;l&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return&nbsp;{&nbsp;time;&nbsp;id;&nbsp;host;&nbsp;parameters;&nbsp;info&nbsp;=&nbsp;<span class="constructor">Info</span>&nbsp;[]&nbsp;}

<span class="keyword">let</span>&nbsp;of_filename&nbsp;experimental&nbsp;filename&nbsp;=
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">String</span>.length&nbsp;filename&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;i&nbsp;=&nbsp;<span class="constructor">Input</span>.create_bytes&nbsp;128&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;aux&nbsp;consumed&nbsp;=&nbsp;<span class="keyword">function</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Parser</span>.<span class="constructor">Fail</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">None</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Parser</span>.<span class="constructor">Read</span>&nbsp;{&nbsp;buffer;&nbsp;k;&nbsp;}&nbsp;<span class="keywordsign">-&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;n&nbsp;=&nbsp;min&nbsp;128&nbsp;(l&nbsp;-&nbsp;consumed)&nbsp;<span class="keyword">in</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Input</span>.write_string&nbsp;buffer&nbsp;filename&nbsp;consumed&nbsp;n;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aux&nbsp;(consumed&nbsp;+&nbsp;n)&nbsp;@@&nbsp;k&nbsp;n&nbsp;(<span class="keyword">if</span>&nbsp;n&nbsp;=&nbsp;0&nbsp;<span class="keyword">then</span>&nbsp;<span class="constructor">Parser</span>.<span class="constructor">Complete</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="constructor">Parser</span>.<span class="constructor">Incomplete</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Parser</span>.<span class="constructor">Done</span>&nbsp;v&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Some</span>&nbsp;v
&nbsp;&nbsp;<span class="keyword">in</span>

&nbsp;&nbsp;aux&nbsp;0&nbsp;@@&nbsp;<span class="constructor">Parser</span>.run&nbsp;i&nbsp;(parse&nbsp;experimental)
</code></body></html>